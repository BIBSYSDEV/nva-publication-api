plugins {
    id 'base'
}

def scriptsPrePushPath = file('.scripts/publication-model-pre-push')
def prePushHookPath = file('./.git/hooks/publication-model-pre-push')

tasks.register('copyPrePushHook', Copy) {
    from scriptsPrePushPath
    into prePushHookPath.parentFile
    onlyIf {
        !prePushHookPath.exists() || scriptsPrePushPath.text != prePushHookPath.text
    }
    doLast {
        if (!System.properties['os.name'].toLowerCase().contains('windows')) {
            println "Making ${prePushHookPath} executable"
            if (!prePushHookPath.setExecutable(true)) {
                throw new GradleException("Failed to make ${prePushHookPath} executable.")
            }
        }
    }
}

build {
    dependsOn('copyPrePushHook')
}
