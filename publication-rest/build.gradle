dependencies {
    //This package is added by SAM template in the runtime environment
    implementation(project(':publication-commons')) {
        exclude group: "software.amazon.ion", module: "ion-java"
    }
    implementation project(':datacite-commons')
    implementation project(':schema-org-metadata')
    implementation project(":tickets")
    implementation project(":publication-event-handlers")

    implementation nvaLibs.apigateway
    implementation nvaLibs.core
    implementation nvaLibs.auth
    implementation nvaLibs.json
    implementation nvaLibs.s3
    implementation nvaLibs.identifiers
    implementation nvaLibs.clients
    implementation project(":publication-model")
    implementation nvaLibs.secrets

    implementation libs.nva.doi.partner.data

    implementation libs.bundles.jaxb
    implementation nvaCatalog.jackson.databind
    implementation nvaCatalog.jackson.core
    implementation nvaCatalog.bundles.logging
    implementation libs.bundles.jaxb

    implementation nvaCatalog.aws.sdk.dynamo
    implementation nvaCatalog.aws.lambda.core
    implementation nvaCatalog.guava
    implementation nvaCatalog.aws.sdk2.secrets
    implementation nvaCatalog.aws.sdk2.s3
    implementation nvaCatalog.zalando
    implementation nvaCatalog.aws.sdk2.eventbridge
    implementation nvaCatalog.aws.sdk2.urlconnection
    implementation libs.bundles.validation

    implementation libs.apache.commons.text

    testImplementation project(":publication-testing")
    testImplementation project(":tickets-test")
    testImplementation libs.mockito.junit.jupiter
    testImplementation libs.javers
    testImplementation project(":publication-model-testing")
    testImplementation nvaLibs.logutils
    testImplementation nvaLibs.testutils
    testImplementation nvaCatalog.zalando
    testImplementation nvaCatalog.wiremock
    testImplementation(libs.httpcore) {
        because "aws-java-sdk-dynamodb needs and we are using it indirectly"
    }

    testImplementation(libs.dynamodDbLocal) {
        exclude group: 'com.amazonaws', module: 'aws-java-sdk-dynamodb'
        exclude group: 'com.amazonaws', module: 'aws-java-sdk-core'
    }

    compileOnly(libs.aws.sdk.apigateway) {
        because "PMD complains for the com/amazonaws/regions/Regions class"
    }
}

test {
    environment "ALLOWED_ORIGIN", "*"
    environment "AWS_REGION", "eu-west-1"
    environment "COGNITO_HOST", "https://example.com"
    environment "ID_NAMESPACE", "https://www.example.org/publication"
    environment "BACKEND_CLIENT_SECRET_NAME", "secret"
    environment "TABLE_NAME", "ResourcesTable"
    environment "BACKEND_CLIENT_AUTH_URL", "https://auth.example.com"
    environment "EXTERNAL_USER_POOL_URI", "https://external-user-pool.example.com"
    environment "API_HOST", "localhost"
    environment "CUSTOM_DOMAIN_BASE_PATH", "publication"
    environment "DOMAIN_NAME", "example.com"
    environment "IMPORT_CANDIDATES_TABLE_NAME", "import-candidates-table"
    environment "RESOURCE_TABLE_NAME", "publications-table"
    environment "NVA_PERSISTED_STORAGE_BUCKET_NAME", "some-persisted-bucket"
    environment "IMPORT_CANDIDATES_STORAGE_BUCKET", "some-candidate-bucket"
    environment "NVA_EVENT_BUS_NAME" , "some-nva-event-bus"
    environment "COGNITO_AUTHORIZER_URLS", "http://localhost:3000"
}
