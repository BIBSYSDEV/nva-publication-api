package no.unit.nva.publication.events.handlers.dynamodbstream;

import static org.hamcrest.MatcherAssert.assertThat;
import static org.hamcrest.Matchers.is;
import static org.hamcrest.Matchers.notNullValue;
import com.fasterxml.jackson.core.JsonProcessingException;
import org.junit.jupiter.api.Test;

public class JacksonDynamodbStreamRecordParserTest {

    private static final String JSON = """
        {"eventID":"8273ff3a1c2ee7a998a5311cc5ce3999","eventName":"MODIFY","eventVersion":"1.1","eventSource":"aws:dynamodb","awsRegion":"eu-west-1","dynamodb":{"ApproximateCreationDateTime":1749811332,"Keys":{"PK0":{"S":"Resource:4a0ccb49-97e2-4d78-948e-4ecc0c924689:1485369@184.0.0.0"},"SK0":{"S":"Resource:0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"}},"NewImage":{"identifier":{"S":"0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"},"data":{"B":"7VfJbtw4EP2Vhs6mdolSXybtDWNMEhu2MwES5ECRpW7CakojUo47gf9r7vNjU5R6Udvo7JcBxgEMp1hSbe+9oj47ZtWAM3WuQdddy8E5crRhptNou3pz/PLi5vezUzS26/PLjwpaZ/rZqYc/nCDOkijNXwRZ7Pr2Hzr3Z7OylJVkRtYK3RbGNHrqeayRrmZKFPWDq+6Zyz5qt1PSuKr2eCu1kcqr2zlT8lP/qLd77+OR03RFJfViyGCd+eXIG2NL8a3ROm3qJbRezHzOizgnOYWQxIJmJI8zIDFw7vM8jNMst8F5C8yAOMVfGCL0w4T4KfGj2yCZ+sE0TFwa0YTGWRC+w0SWtZClfOYfoL8/jcNpELo0pH7qR75v/Te1HQgQTZPMDf00zNKM9g8wrWsubUqz1siScYNDe7/tyxUoIdX8sgF1LivoWwPK2Jzs3PycZmlcAkn9sCCxX1CSQxETSCAtIeMljQQ+o9jSvkyEbqPmtiq5hNshgFyyOXiDWctPaApyzC85cirJQWkYDaLvnbwHXi+XtdIujthbe2mvWHk4Y8+iTM4XRl+DsYnW6sa0WN58NZr2666qrg944YhqVcp514K4/bo7jrRrqpqJUzBMVnoU5Y2G9s3e2cYXxPHqAOo3DofmF+QuzjuKUp8iQB4fPxw5NiOzOgWN0G8GpmxzOHt2ht1nUt1KU9nzW9BmcscUqwAnqu9YMwknZFJ26g7aCTw0TGl8alLPJ1IJuMOSEA6/uRuo8Z4xQ7I70Dw5OXJWwNp1NT0JamVaWXSmbvfQdrKzb5FmxoO72Ji+h6JrQWiwPisFQ9N3qPwDjKwmM6ZZ+8/fFq33WGO5zv9mI2N/9kYQNn22E6W99H9YRL4iWTjjtq7GHT6xTMAmYTIa/upAcUsc29gWNbape9LOOrNAn2nJKg39S6CEdvD9vJPsjW1vonYS8GBGjqcwb6FXduwE7OFc9YxplyBuhrMDInu1tX1Hc0ZJEb5gSkGlyX3obQN4YZocR6E/I+fpeULi4ywgeTg7I+d+PjtLs9kxTQOvhx7OllU2smk7eHzcq/hC4cra781Q8jHjC6h6RDaoVePKX9WqnresWVz1B1hVVeFCsNIgNn23YVhhjdwcIFyPKSGkTYNVF1uB3efGAJLdqR1Fv01fDzjGxr1QqFRDlZ01Bb79icIeQrzDvBAWtlBpuh16fxVO93i9TdfG+BmefhiQO5R6do/Vj6HXCNvr673jI0d8YVsGQZjncdhv107v3T5Cnya7YuSuTz/Tnycv3dueQU7TDHAfp5SULCgFDQoSJFTgBSLISBaFlGSCcUo5yws2aOczHEx/EUYQ38O2t5v+/1vAf+wWIAZ97qUNJ9nKukVB+QTipGLYaDFayieDjL6VZiHVDa+bvdVyyP2HrsVrxSbcvvWblNq2fv30xXeHC2IR5wzxh/xBEqWxIAWNQpLERcLjlEPKuf20GBH0Qvw6diNmrNDLQaPWGwqJc1VjL+2sUaDaVa0sg8Dq/eio/ya6VJXFnh5m8v75BhoMr5g2sPvv1cLSy97fMUE+tg1/v7TsMHK4il0a3Jk3prMEflu3dyiwmPgwpjXSN59s10+J/o3z26j1xVOxi1AluJ8K4icIbs4pEZAzEodQEuZHGfFZSKMiZWVEY+crH0vxNKJuElJK/SBJvvCx9Mw/zrLgneWs/LkEH/8F"},"type":{"S":"Resource"},"version":{"S":"826781d0-23e9-4d44-8c52-e47c3f4bfa74"},"PK0":{"S":"Resource:4a0ccb49-97e2-4d78-948e-4ecc0c924689:1485369@184.0.0.0"},"PK2":{"S":"Customer:4a0ccb49-97e2-4d78-948e-4ecc0c924689:Resource:0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"},"PK1":{"S":"Resource:Customer:4a0ccb49-97e2-4d78-948e-4ecc0c924689:Status:PUBLISHED"},"PK4":{"S":"CristinIdentifier:10000032"},"SK1":{"S":"Resource:0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"},"modifiedDate":{"S":"2025-06-13T10:42:12.727060300Z"},"PK3":{"S":"Resource:0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"},"SK0":{"S":"Resource:0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"},"SK3":{"S":"Resource:0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"},"SK2":{"S":"a:Resource:0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"},"SK4":{"S":"Resource:0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"},"status":{"S":"PUBLISHED"}},"OldImage":{"identifier":{"S":"0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"},"data":{"B":"7Vfbbts4EP0Vw8+hRV0p+WXr3LDGtpsgSbdAiz5Q5MgmIlNakUrrFvmvfd8f26Hki5zA2+vLAusAhjMz0tzOnCE/j+26hvF0fAOmahsB45Oxsdy2BmXXr09fzm9/vThHYbPRX33Q0Iynn8dV/2PsR2kcJtkLP40m1P2hcaebFYUqFbeq0mi2tLY2U8/jtZoYrmVefZzoBz7hH8yk1cpOdOWJRhmrtFc1C67Vp+5Rb//ex5Nx3ealMss+gk3kVwNr9K3k13prja1W0HgRp0LkUUYyBgGJJEtJFqVAIhCCiiyIkjRzzkUD3II8xy90EdAgJjQhNLzz4yn1p0E8YSGLWZT6wVsMZFVJVahn9n54R7NpnEwDOvFpmDKfpamz3+Z2xEE4jdNJQJMgTVJG3QPcmEooF9KssargwmLT3u3qcg1aKr24qkFfqhK60oC2LibXN5qxNIkKIAkNchLRnJEM8ohADEkBqShYKPEZzVfuZTKY1HrhslIruOsdqBVfgNeLjfqEIj/D+OKTcakEaAODRnS1Uw8gqtWq0maCLfY2VsbL1x722HMoU4ulNTdgXaCVvrUNprdYD7r9e1uWN0essEWVLtSibUDefdkcW9rWZcXlOViuSjPw8tpA8/pAt7UFebo+gvqtwbH++dkkYDQME8oQII+P70/GLiK7PgeD0K/7SdnFcPFMh9XnSt8pWzr9HRg7uueal4AdNfe8HgUjMipafQ/NCD7WXBt8alQtRkpLuMeUEA6/bJEmuoHpY91j5onmZLwG3myS6Wag0rZReWur5gBsZ3v5Dmh22Lf5VvQtE7rhgxrTc0zQ13wPyt/AqnI044Y3f//lwPqAKRab+G+3LPZHJwTpwud7TjoI/7s55AuMhS1uqnJY4TM3CFgkDMbAny1o4ebGFbZBiq2rbmZnrV2izbTgpYHuJVBA09t+3jP2VnbQUdcJ+GgHhuewaKAjdqwEHMBcdwPTrEDe9rojHHu9k31DcQZBEbHkWkNpyEPg7Rx4QRKfhgGdkcvkMibRaeqTLJhdkEuazS6SdHbKEt/roIe95aXzbJsWHh8PMp5r3FiHtelTPuViCWWHyBqpapj5q0pXi4bXy+tOgVmVJe4DxwxyW3fnhudOKOyReeswJaVyYfByvuPXw9noQbLXulZ0y/T3HsdYuBcaiarPsnUin7pPGHQQEi3GhbBwiSrb7tH7s3B6MNe7cJ2PH5nT9z1y+1QvHjD7IfRq6Wp9c6A+Gcvjy5KmWRSylDG3+1pzcPgIKIv3yah9nX6kPk9eerA8/YwlaZ7SuMhIGskMfJkSwQNOoiyhhBd5QAoGKAg4k1nQnx+e4mD6kzCC+O6XvVv0/x8C/mOHANnzc0dt2MlGVQ0SyieQZyXHQsvBUj7rafSNskulb0VVH6yWY+bfdSreMDYR7q1fxdSu9Jun59/szo9klHHEXyR9SaIkkiRnYUDiKI9FlAhIhHA3i8GAzuXPm27EjCN61XPUZkPh4FxXWEvXaySoZl1pN0Hg+H6g6q5EV7p02DN9T94930C94BU3Fvb/Xi/deLnjOwYohrL+90s3HVb1R7Erizvz1rZugN9UzT0SLAbet2mD9O2N7ebpoH9l/7ZsPX9KdiGyhKCJJDRGcAvBiIQMyS6AgnC8xRDKAxbmCS9CFo2/cFeKpiGbxAFjjPpx/C93pWf2UZr6b93Mqh8L8PEf"},"type":{"S":"Resource"},"version":{"S":"8b8d051b-46b1-4c2c-8bba-59da1a8b44ab"},"PK0":{"S":"Resource:4a0ccb49-97e2-4d78-948e-4ecc0c924689:1485369@184.0.0.0"},"PK2":{"S":"Customer:4a0ccb49-97e2-4d78-948e-4ecc0c924689:Resource:0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"},"PK1":{"S":"Resource:Customer:4a0ccb49-97e2-4d78-948e-4ecc0c924689:Status:PUBLISHED"},"PK4":{"S":"CristinIdentifier:10000032"},"SK1":{"S":"Resource:0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"},"modifiedDate":{"S":"2025-06-13T09:56:20.103871788Z"},"PK3":{"S":"Resource:0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"},"SK0":{"S":"Resource:0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"},"SK3":{"S":"Resource:0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"},"SK2":{"S":"a:Resource:0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"},"SK4":{"S":"Resource:0197364fc06d-05dedcc7-de9a-42ef-a038-0a273b6af374"},"status":{"S":"PUBLISHED"}},"SequenceNumber":"359714700002294955437572846","SizeBytes":4318,"StreamViewType":"NEW_AND_OLD_IMAGES"},"eventSourceARN":"arn:aws:dynamodb:eu-west-1:750639270376:table/nva-resources-master-pipelines-NvaPublicationApiPipeline-1OZ30CUV4WUP-nva-publication-api/stream/2025-03-28T12:27:39.643"}
        """;

    @Test
    public void dynamodbStreamRecordParserTest() throws JsonProcessingException {
        var parser = new JacksonDynamodbStreamRecordParser();

        var record = parser.fromDynamoEventStreamRecordAsJson(JSON);

        assertThat(record, is(notNullValue()));
    }
}
